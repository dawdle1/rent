<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bike Rental</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f14;
  color: #fff;
}
header {
  padding: 20px;
  text-align: center;
  background: #15151c;
  font-size: 22px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
  gap: 16px;
  padding: 16px;
}
.card {
  background: #1b1b24;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,.4);
  display: flex;
  flex-direction: column;
}
.card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}
.card .body {
  padding: 14px;
  flex: 1;
  display: flex;
  flex-direction: column;
}
.card h3 {
  margin: 0 0 6px;
}
.status {
  margin: 6px 0 12px;
  font-size: 14px;
}
.status.booked { color: #ff6b6b; }
.status.available { color: #51cf66; }

.book-btn {
  margin-top: auto;
  padding: 10px;
  border: none;
  border-radius: 8px;
  background: #ffb703;
  font-size: 15px;
  cursor: pointer;
}
.book-btn:disabled {
  background: #666;
  cursor: not-allowed;
}

/* Modal */
#modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  display: none;
  align-items: center;
  justify-content: center;
}
#modal .box {
  background: #1b1b24;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 360px;
}
#modal input, #modal textarea {
  width: 100%;
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 6px;
  border: none;
}
#modal button {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 8px;
  background: #ffb703;
  font-size: 15px;
}
#bk_status {
  margin-top: 8px;
  text-align: center;
  font-size: 14px;
}
</style>
</head>

<body>

<header>üèç Bike Rental</header>
<div class="grid" id="grid"></div>

<!-- Modal -->
<div id="modal">
  <div class="box">
    <h3 id="bk_title">Book bike</h3>
    <input id="bk_name" placeholder="Your name">
    <input id="bk_contact" placeholder="Phone / Telegram">
    <textarea id="bk_dates" placeholder="Dates"></textarea>
    <button onclick="sendBooking()">Send request</button>
    <div id="bk_status"></div>
  </div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/18S9ycZPmDdfpSd-IRoT9-vIZH07cGZBQxErdJ1xbvjw/edit?gid=510031858#gid=510031858";
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx-4E_xUtx1oODIMpQR6puFDisnpgoIaKTdoJzsS4OyZI9zALScAWb1vKcUUCcoLwHwsg/exec";

let selectedBike = "";

function loadBikes() {
  fetch(CSV_URL)
    .then(r => r.text())
    .then(t => render(parseCSV(t)));
}

function parseCSV(text) {
  const lines = text.trim().split("\n").slice(1);
  return lines.map(l => {
    const p = l.split(",");
    return {
      brand: p[0],
      model: p[1],
      image: p[2],
      status: (p[3] || "").trim().toLowerCase()
    };
  });
}

function render(bikes) {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  bikes.forEach(b => {
    const card = document.createElement("div");
    card.className = "card";

    const img = document.createElement("img");
    img.src = b.image;

    const body = document.createElement("div");
    body.className = "body";

    const h = document.createElement("h3");
    h.textContent = `${b.brand} ${b.model}`;

    const st = document.createElement("div");
    st.className = "status " + (b.status === "booked" ? "booked" : "available");
    st.textContent = "Status: " + (b.status === "booked" ? "Booked" : "Available");

    const btn = document.createElement("button");
    btn.className = "book-btn";

    if (b.status === "booked") {
      btn.textContent = "Booked";
      btn.disabled = true;
    } else {
      btn.textContent = "Book";
      btn.onclick = () => openBooking(`${b.brand} ${b.model}`);
    }

    body.appendChild(h);
    body.appendChild(st);
    body.appendChild(btn);

    card.appendChild(img);
    card.appendChild(body);

    grid.appendChild(card);
  });
}

function openBooking(bike) {
  selectedBike = bike;
  document.getElementById("bk_title").innerText = "Book: " + bike;
  document.getElementById("bk_status").innerText = "";
  document.getElementById("modal").style.display = "flex";
}

function closeBooking() {
  document.getElementById("modal").style.display = "none";
}

function sendBooking() {
  const name = bk_name.value.trim();
  const contact = bk_contact.value.trim();
  const dates = bk_dates.value.trim();

  if (!name || !contact || !dates) {
    bk_status.innerText = "‚ùå Fill all fields";
    return;
  }

  fetch(SCRIPT_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ name, contact, dates, bike: selectedBike })
  })
  .then(() => {
    bk_status.innerText = "‚úÖ Sent!";
    setTimeout(() => {
      closeBooking();
      loadBikes(); // –æ–±–Ω–æ–≤–∏–º —Å–ø–∏—Å–æ–∫
    }, 1500);
  })
  .catch(() => {
    bk_status.innerText = "‚ùå Error";
  });
}

// close modal on background click
document.getElementById("modal").onclick = e => {
  if (e.target.id === "modal") closeBooking();
};

loadBikes();
</script>

</body>
</html>
