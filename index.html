<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bike Rental</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body { font-family: Arial, sans-serif; margin: 0; background:#f5f5f5; }
.no-scroll { overflow: hidden; height: 100%; }

header { background:#111; color:#fff; padding:15px; text-align:center; }
.container { max-width:1200px; margin:auto; padding:15px; }
.grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); gap:15px; }
.card { background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,.1); }
.card img { width:100%; height:180px; object-fit:cover; cursor:pointer; }
.card-body { padding:10px; }
.price { font-weight:bold; }
.status.free { color:green; }
.status.booked { color:red; }

button.book-btn {
  width:100%; margin-top:10px; padding:10px;
  background:#111; color:#fff; border:none; cursor:pointer;
  border-radius:4px;
}

.slider { position:relative; }
.slider button {
  position:absolute; top:50%; transform:translateY(-50%);
  background:rgba(0,0,0,.5); color:#fff; border:none; font-size:18px;
  padding:5px 10px; cursor:pointer;
}
.slider .prev { left:5px; }
.slider .next { right:5px; }

/* Lightbox */
.lightbox {
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
  touch-action: pan-x;
}
.lightbox.show { display:flex; }
.lightbox img { max-width:95%; max-height:95%; }
.lightbox .close {
  position:absolute; top:20px; right:25px;
  font-size:30px; color:#fff; cursor:pointer;
}
.lightbox .nav {
  position:absolute; top:50%;
  transform:translateY(-50%);
  font-size:40px; color:#fff; cursor:pointer;
  padding:10px; user-select:none;
}
.lightbox .prev { left:20px; }
.lightbox .next { right:20px; }

/* Booking modal */
.modal {
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1100;
}
.modal.show { display:flex; }
.modal-content {
  background:#fff; padding:20px;
  border-radius:8px; width:90%; max-width:400px;
}
.modal-content h3 { margin-top:0; }
.modal-content input {
  width:100%; padding:8px; margin-bottom:10px;
}
.modal-content button {
  width:100%; padding:10px;
  background:#111; color:#fff; border:none; cursor:pointer;
}
.modal-close {
  text-align:right; cursor:pointer; color:#999;
}
</style>
</head>
<body>

<header>
  <h1>Bike Rental</h1>
</header>

<div class="container">
  <div id="grid" class="grid"></div>
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox">
  <span class="close" onclick="closeLightbox()">×</span>
  <span class="nav prev" onclick="lbPrev()">‹</span>
  <img id="lightbox-img" src="" />
  <span class="nav next" onclick="lbNext()">›</span>
</div>

<!-- Booking modal -->
<div id="bookingModal" class="modal">
  <div class="modal-content">
    <div class="modal-close" onclick="closeBooking()">✕</div>
    <h3>Book bike</h3>
    <input id="bk_name" placeholder="Your name" />
    <input id="bk_contact" placeholder="Phone (e.g. +66812345678)" />
    <input id="bk_dates" type="date" />
    <input id="bk_bike" placeholder="Bike" readonly />
    <button onclick="sendBooking()">Send booking</button>
    <p id="bk_status"></p>
  </div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQkiyZdafVIMIamvuz4dP7PvJwfuzIYAw0k1_NjhQYbpFNCz7jfb0xn3blCawJrIfZuUgC4beUQd8vP/pub?gid=510031858&single=true&output=csv";
const IMAGE_PATH = "Images/";

// Telegram
const TOKEN = "8569147206:AAFvjIvwo6PbwrGkrGjnXArUVqxtoF9G5E4";
const CHAT_ID = "166993928";

let lbImages = [];
let lbIndex = 0;

function parseCSV(text) {
  const rows = [];
  let row = [], cell = "", inside = false;
  for (let c of text) {
    if (c === '"') inside = !inside;
    else if (c === ',' && !inside) { row.push(cell); cell = ""; }
    else if ((c === '\n' || c === '\r') && !inside) {
      if (cell || row.length) { row.push(cell); rows.push(row); }
      row = []; cell = "";
    } else cell += c;
  }
  if (cell || row.length) { row.push(cell); rows.push(row); }
  return rows;
}

fetch(CSV_URL)
  .then(r => r.text())
  .then(text => {
    const data = parseCSV(text);
    const headers = data[0];
    const rows = data.slice(1);

    const bikes = rows.map(r => {
      const obj = {};
      headers.forEach((h,i) => obj[h.trim()] = (r[i]||"").trim());
      return obj;
    });

    render(bikes);
  });

function render(bikes){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  bikes.forEach(b => {
    const images = b.image_urls
      ? b.image_urls.split("|").map(x => IMAGE_PATH + x.trim())
      : ["https://via.placeholder.com/400x300?text=No+Image"];

    let idx = 0;

    const card = document.createElement("div");
    card.className = "card";

    const slider = document.createElement("div");
    slider.className = "slider";

    const img = document.createElement("img");
    img.src = images[0];
    img.onclick = () => openLightbox(images, idx);
    slider.appendChild(img);

    if(images.length > 1){
      const prev = document.createElement("button");
      prev.className = "prev";
      prev.textContent = "<";
      prev.onclick = ()=>{ idx = (idx-1+images.length)%images.length; img.src = images[idx]; };

      const next = document.createElement("button");
      next.className = "next";
      next.textContent = ">";
      next.onclick = ()=>{ idx = (idx+1)%images.length; img.src = images[idx]; };

      slider.appendChild(prev);
      slider.appendChild(next);
    }

    card.appendChild(slider);

    const body = document.createElement("div");
    body.className = "card-body";
    body.innerHTML = `
      <div><b>${b.brand} ${b.model}</b> ${b.year || ""}</div>
      <div class="price">Day: ${b.price_day_thb || "-"} THB</div>
      <div class="price">Month: ${b.price_month_thb || "-"} THB</div>
      <div class="status ${b.status}">Status: ${b.status}</div>
    `;

    const btn = document.createElement("button");
    btn.className = "book-btn";
    btn.textContent = "Book";
    btn.onclick = () => openBooking(`${b.brand} ${b.model}`);

    body.appendChild(btn);
    card.appendChild(body);
    grid.appendChild(card);
  });
}

// Lightbox
function openLightbox(images, index){
  lbImages = images;
  lbIndex =
